<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The directory layer offers subspace indirection, where logical application subspaces are mapped to short, auto-generated key prefixes. This prefix assignment is done by the High Contention Allocator, which allows many clients to allocate short directory prefixes efficiently."><title>foundationdb::tuple::hca - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-42caa33d.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="foundationdb" data-themes="" data-resource-suffix="" data-rustdoc-version="1.84.0 (9fc6b4312 2025-01-07)" data-channel="1.84.0" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../foundationdb/index.html">foundationdb</a><span class="version">0.9.2</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module hca</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In foundationdb::<wbr>tuple</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">foundationdb</a>::<wbr><a href="../index.html">tuple</a></span><h1>Module <span>hca</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/foundationdb/tuple_ext/hca.rs.html#9-230">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The directory layer offers subspace indirection, where logical application subspaces are mapped to short, auto-generated key prefixes. This prefix assignment is done by the High Contention Allocator, which allows many clients to allocate short directory prefixes efficiently.</p>
<p>The allocation process works over candidate value windows. It uses two subspaces to operate, the “counters” subspace and “recents” subspace (derived from the subspace used to create the HCA).</p>
<p>“counters” contains a single key : “counters : window_start”, whose value is the number of allocations in the current window. “window_start” is an integer that marks the lower bound of values that can be assigned from the current window.
“recents” can contain many keys : “recents : candidate”, where each “candidate” is an integer that has been assigned to some client</p>
<p>Assignment has two stages that are executed in a loop until they both succeed.</p>
<ol>
<li>
<p>Find the current window. The client scans “counters : *” to get the current “window_start” and how many allocations have been made in the current window.
If the window is more than half-full (using pre-defined window sizes), the window is advanced: “counters : *” and “recents : *” are both cleared, and a new “counters : window_start + window_size” key is created with a value of 0. (1) is retried
If the window still has space, it moves to (2).</p>
</li>
<li>
<p>Find a candidate value inside that window. The client picks a candidate number between “[window_start, window_start + window_size)” and tries to set the key “recents : candidate”.
If the write succeeds, the candidate is returned as the allocated value. Success!
If the write fails because the window has been advanced, it repeats (1).
If the write fails because the value was already set, it repeats (2).</p>
</li>
</ol>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.HighContentionAllocator.html" title="struct foundationdb::tuple::hca::HighContentionAllocator">High<wbr>Contention<wbr>Allocator</a></div><div class="desc docblock-short">Represents a High Contention Allocator for a given subspace</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.HcaError.html" title="enum foundationdb::tuple::hca::HcaError">HcaError</a></div></li></ul></section></div></main></body></html>